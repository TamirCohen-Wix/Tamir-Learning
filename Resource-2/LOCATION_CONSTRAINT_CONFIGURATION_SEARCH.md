# Location Constraint Configuration Search

## Summary

**No explicit configuration found** in this codebase that marks location fields as authorization constraints. The constraint_filter appears to be **automatically generated by Nile Search infrastructure** based on field name patterns and user token context.

## Places Checked

### 1. **Proto WQL Definitions** ✅ Checked
**File:** `proto/wix/bookings/resources/v2/resources_service.proto`

**Location fields defined as filterable (lines 401-405, 443-447, 460-464):**
```protobuf
field: "single_resource.location_options.available_in_all_locations"
field: "single_resource.location_options.specific_location_options.business_locations.location_id"
field: "location_options.specific_location_options.business_locations.location_id"
```

**Status:** These are just **filterable fields** in WQL, NOT marked as constraints. No special constraint/authorization annotations found.

### 2. **SearchOptions Configuration** ✅ Checked
**File:** `src/com/wixpress/bookings/resources/v2/ResourcesService.scala` (line 560)

```scala
searchOptions = SearchOptions(contextBuilder.config.appSecret),
```

**Status:** `SearchOptions` comes from external module `generators.modules.search.share.SearchOptions`. Only `appSecret` is passed - **no location constraint configuration**.

### 3. **SDL Configuration** ✅ Checked
**File:** `src/com/wixpress/bookings/resources/v2/ResourcesService.scala` (lines 538-553)

```scala
sdlBuilder = _.withResource(
  _.withTenantExtractor(TenantExtractors.metaSite)
    .withDomainEventsEnabled(_.toResource)
    .withContractToDomainFieldPathTranslator(...)
    .withGdpr(...)
    .withDbLogsVisibility(...)
    .withSdlOptions(...)
    .withCloneTenantWithCtx()
    .withPermanentSiteDeletedHandler,
)
```

**Status:** **No location constraint configuration** in SDL setup. No `.withAuthorizationConstraint()` or similar methods.

### 4. **Domain Entity Definitions** ✅ Checked
**Files:**
- `src/com/wixpress/bookings/resources/v2/domain/LocationOptionsDomain.scala`
- `src/com/wixpress/bookings/resources/v2/domain/ResourceFieldNames.scala`

**Status:** Just regular case classes and field name constants. **No annotations, no constraint metadata, no authorization markers**.

### 5. **BUILD Files** ✅ Checked
**File:** `src/com/wixpress/bookings/resources/v2/domain/BUILD.bazel`

```bazel
sdl_scala_domain(
    name = "domain",
    srcs = glob(["*.scala"]),
    deps = [...],
)
```

**Status:** Standard SDL domain macro. **No constraint configuration**.

### 6. **Field Path Translators** ✅ Checked
**File:** `src/com/wixpress/bookings/resources/v2/mappers/ResourceProtoToDomainMappers.scala`

**Status:** `ResourceTranslator` only handles field path translation between API and domain. **No constraint configuration**.

### 7. **Proto Annotations** ✅ Checked
**File:** `proto/wix/bookings/resources/v2/resources_service.proto`

**Status:** Only standard Wix API annotations found:
- `option (wix.api.permission).name = "BOOKINGS.RESOURCE_READ"` - Standard permission, not location constraint
- No constraint/authorization annotations on location fields

### 8. **Code Search Results** ✅ Checked
Searched for:
- `constraint.*location`
- `authorization.*location`
- `location.*constraint`
- `@constraint`
- `@authorization`
- `SearchOptions` configuration details

**Status:** **No matches found** for explicit location constraint configuration.

## Conclusion

**Location fields are NOT explicitly configured as constraints in this codebase.**

The constraint_filter is likely generated automatically by Nile Search infrastructure based on:

1. **Field Name Pattern Recognition:**
   - Fields containing `location` or `locationId` in their path
   - Pattern: `*location*` or `*locationId*`

2. **User Token Context:**
   - When user token has location restrictions
   - Nile Search infrastructure detects this and automatically generates constraint_filter

3. **Domain Field Structure:**
   - Nile Search uses domain entity field paths (camelCase)
   - Automatically builds constraint_filter for location-related fields

## Where the Constraint Logic Likely Lives

The constraint_filter generation logic is **NOT in this codebase**. It's likely in:

1. **Nile Search Infrastructure** (external framework)
   - Automatically detects location fields by name pattern
   - Generates constraint_filter when user has location restrictions

2. **SDL/Nile Search Integration Layer** (external module)
   - `generators.modules.search.share.SearchOptions` may contain configuration
   - But only `appSecret` is passed from this codebase

3. **Wix Platform Authorization Layer**
   - Detects location restrictions in user tokens
   - Passes this info to Nile Search infrastructure

## Recommendation

Since location is just "random data" and shouldn't be a constraint, you may need to:

1. **Check Nile Search Infrastructure Documentation:**
   - How to disable automatic location constraint generation
   - Configuration options in `SearchOptions`

2. **Check Wix Platform Authorization:**
   - How location restrictions are detected in tokens
   - Whether this can be disabled for this entity

3. **Field Naming:**
   - If Nile Search uses pattern matching on field names, consider if renaming would help
   - But this might break existing functionality

4. **Contact Wix Platform Team:**
   - Ask how to disable automatic location constraint generation for this entity
   - Or how to configure field path translation for constraint_filter

## Key Finding

**The constraint_filter is generated OUTSIDE this codebase** by Nile Search infrastructure, likely based on:
- Field name pattern matching (`*location*`)
- User token location restrictions
- Automatic inference, not explicit configuration

